!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var l,s,d,c,u,m,p,e,t,a,r,i,f,n;s=Object.create,d=Object.defineProperty,c=Object.getOwnPropertyDescriptor,u=Object.getOwnPropertyNames,m=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty,a=(e=(e,t)=>function(){return t||(0,e[u(e)[0]])((t={exports:{}}).exports,t),t.exports})({"external-global-plugin:react-dom"(e,t){t.exports=Spicetify.ReactDOM}}),r=(t=(e,t,a)=>{a=null!=e?s(m(e)):{};var i=!t&&e&&e.__esModule?a:d(a,"default",{value:e,enumerable:!0}),n=e,o=void 0,r=void 0;if(n&&"object"==typeof n||"function"==typeof n)for(let e of u(n))p.call(i,e)||e===o||d(i,e,{get:()=>n[e],enumerable:!(r=c(n,e))||r.enumerable});return i})(e({"external-global-plugin:react"(e,t){t.exports=Spicetify.React}})()),i=t(a()),f=new class{constructor(e,t,a={}){this.name=e,this.settingsId=t,this.initialSettingsFields=a,this.settingsFields=this.initialSettingsFields,this.setRerender=null,this.pushSettings=async()=>{for(Object.entries(this.settingsFields).forEach(([e,t])=>{"button"!==t.type&&void 0===this.getFieldValue(e)&&this.setFieldValue(e,t.defaultValue)});!Spicetify?.Platform?.History?.listen;)await new Promise(e=>setTimeout(e,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(e=>{"/preferences"===e.pathname&&this.render()}),"/preferences"===Spicetify.Platform.History.location.pathname&&await this.render()},this.rerender=()=>{this.setRerender&&this.setRerender(Math.random())},this.render=async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if("/preferences"!==Spicetify.Platform.History.location.pathname)return;await new Promise(e=>setTimeout(e,100))}var e=document.querySelector(".main-view-container__scroll-node-child main div");if(!e)return console.error("[spcr-settings] settings container not found");let t=Array.from(e.children).find(e=>e.id===this.settingsId);t?console.log(t):((t=document.createElement("div")).id=this.settingsId,e.appendChild(t)),i.default.render(r.default.createElement(this.FieldsContainer,null),t)},this.addButton=(e,t,a,i,n)=>{this.settingsFields[e]={type:"button",description:t,value:a,events:{onClick:i,...n}}},this.addInput=(e,t,a,i,n,o)=>{this.settingsFields[e]={type:"input",description:t,defaultValue:a,inputType:n,events:{onChange:i,...o}}},this.addHidden=(e,t)=>{this.settingsFields[e]={type:"hidden",defaultValue:t}},this.addToggle=(e,t,a,i,n)=>{this.settingsFields[e]={type:"toggle",description:t,defaultValue:a,events:{onChange:i,...n}}},this.addDropDown=(e,t,a,i,n,o)=>{this.settingsFields[e]={type:"dropdown",description:t,defaultValue:a[i],options:a,events:{onSelect:n,...o}}},this.getFieldValue=e=>JSON.parse(Spicetify.LocalStorage.get(this.settingsId+"."+e)||"{}")?.value,this.setFieldValue=(e,t)=>{Spicetify.LocalStorage.set(this.settingsId+"."+e,JSON.stringify({value:t}))},this.FieldsContainer=()=>{var[e,t]=(0,r.useState)(0);return this.setRerender=t,r.default.createElement("div",{className:"x-settings-section",key:e},r.default.createElement("h2",{className:"TypeElement-cello-textBase-type"},this.name),Object.entries(this.settingsFields).map(([e,t])=>r.default.createElement(this.Field,{nameId:e,field:t})))},this.Field=a=>{var e=this.settingsId+"."+a.nameId;let t;if(t="button"===a.field.type?a.field.value:this.getFieldValue(a.nameId),"hidden"===a.field.type)return r.default.createElement(r.default.Fragment,null);const[i,n]=(0,r.useState)(t),o=e=>{void 0!==e&&(n(e),this.setFieldValue(a.nameId,e))};return r.default.createElement("div",{className:"x-settings-row"},r.default.createElement("div",{className:"x-settings-firstColumn"},r.default.createElement("label",{className:"TypeElement-viola-textSubdued-type",htmlFor:e},a.field.description||"")),r.default.createElement("div",{className:"x-settings-secondColumn"},"input"===a.field.type?r.default.createElement("input",{className:"x-settings-input",id:e,dir:"ltr",value:i,type:a.field.inputType||"text",...a.field.events,onChange:e=>{o(e.currentTarget.value);var t=a.field.events?.onChange;t&&t(e)}}):"button"===a.field.type?r.default.createElement("span",null,r.default.createElement("button",{id:e,className:"Button-sc-y0gtbx-0 Button-small-buttonSecondary-useBrowserDefaultFocusStyle x-settings-button",...a.field.events,onClick:e=>{o();var t=a.field.events?.onClick;t&&t(e)},type:"button"},i)):"toggle"===a.field.type?r.default.createElement("label",{className:"x-settings-secondColumn x-toggle-wrapper"},r.default.createElement("input",{id:e,className:"x-toggle-input",type:"checkbox",checked:i,...a.field.events,onClick:e=>{o(e.currentTarget.checked);var t=a.field.events?.onClick;t&&t(e)}}),r.default.createElement("span",{className:"x-toggle-indicatorWrapper"},r.default.createElement("span",{className:"x-toggle-indicator"}))):"dropdown"===a.field.type?r.default.createElement("select",{className:"main-dropDown-dropDown",id:e,...a.field.events,onChange:e=>{o(a.field.options[e.currentTarget.selectedIndex]);var t=a.field.events?.onChange;t&&t(e)}},a.field.options.map((e,t)=>r.default.createElement("option",{selected:e===i,value:t+1},e))):r.default.createElement(r.default.Fragment,null)))}}}("Cat-Jam Settings","catjam-settings"),n=async function(){for(var e;null==(e=null==Spicetify?void 0:Spicetify.Player)||!e.addEventListener||null==Spicetify||!Spicetify.getAudioData;)await new Promise(e=>setTimeout(e,100));console.log("[CAT-JAM] Extension loaded.");let i,n=(f.addInput("catjam-webm-link","Custom URL",""),f.addInput("catjam-webm-bpm","BPM",""),f.addDropDown("catjam-webm-position","Pos",["Left","Bottom"],0),f.addDropDown("catjam-webm-position-left-size","Size",""),f.addDropDown("catjam-webm-bpm-method","Method",["Track BPM","Advanced"],0),f.addDropDown("catjam-webm-bpm-method-faster-songs","Fast Method",["Track BPM","Advanced"],0),f.addButton("catjam-reload","Reload","Save",()=>{h()}),f.pushSettings(),h(),Spicetify.Player.addEventListener("onplaypause",async()=>{var e=performance.now(),t=Spicetify.Player.getProgress();o(e,n=t)}),0);Spicetify.Player.addEventListener("onprogress",async()=>{var e=performance.now(),t=Spicetify.Player.getProgress();500<=Math.abs(t-n)&&o(e,t),n=t}),Spicetify.Player.addEventListener("songchange",async()=>{var e,t=performance.now();n=Spicetify.Player.getProgress();const a=document.getElementById("catjam-webm");if(a){i=await g();if(i&&i.beats&&0<i.beats.length){e=i.beats[0].start;a.playbackRate=await y(i);t=performance.now()-t;e=Math.max(0,1e3*e-t);setTimeout(()=>{a.currentTime=0;a.play()},e)}else{a.playbackRate=await y(i);a.currentTime=0;a.play()}}})},(async()=>{await n()})();async function y(a){let i=Number(f.getFieldValue("catjam-webm-bpm"))||135.48;if(a?.track){let e=a.track.tempo;let t=1;if("Track BPM"!==f.getFieldValue("catjam-webm-bpm-method")){e=await b(e)}if(e){t=e/i}return t}return 1}async function g(t=200,a=10){try{return await Spicetify.getAudioData()}catch(e){return null}}async function o(e,t){const a=document.getElementById("catjam-webm");if(a){if(Spicetify.Player.isPlaying()){t/=1e3;if(l?.beats){let i=l.beats.find(e=>e.start>t);if(i){e=performance.now()-e;i=Math.max(0,1e3*(i.start-t)-e);setTimeout(()=>{a.currentTime=0;a.play()},i)}else{a.currentTime=0;a.play()}}else{a.currentTime=0;a.play()}}else{a.pause()}}}async function h(){try{var r=document.getElementById("catjam-webm");if(r)r.remove();let t=String(f.getFieldValue("catjam-webm-link"))||"https://github.com/BlafKing/spicetify-cat-jam-synced/raw/main/src/resources/catjam.webm";var s=document.createElement("video");s.id="catjam-webm";s.setAttribute("loop","true");s.setAttribute("autoplay","true");s.setAttribute("muted","true");s.src=t;/* POSICIÃ“N FINAL AJUSTADA A 90px */s.style.cssText="width:364px !important; height:337px !important; object-fit:cover; pointer-events:none; z-index:99999; position:fixed; left:0; bottom:88px; background:transparent !important; border:none !important; box-shadow:none !important; outline:none !important;";document.body.appendChild(s);l=await g();s.playbackRate=await y(l);if(Spicetify.Player.isPlaying())s.play();else s.pause()}catch(e){console.error("[CAT-JAM] Error: ",e)}}async function b(e){return e}}();